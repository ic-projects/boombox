<!DOCTYPE html>
<html>
<head>
  <!-- note: for support on older browsers, you will need to load es5-shim and es6-shim -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.0.5/es5-shim.min.js"></script> 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/es6-shim/0.23.0/es6-shim.min.js"></script> 
 
  <script src="/timesync/timesync.js"></script> 
	<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
  <script src="/socket.io/socket.io.js"></script>            
	<script>
	  // create a timesync instance
	  var ts = timesync.create({
	    server: '/timesync',
	    interval: 10000
	  });
	  
	  var OFFSET = 0;

	  var socket = io.connect('http://localhost:30000');
	  socket.on('connection', function(data) {
	  	console.log("successfully connected to the server")
	  });
	 
	  // get notified on changes in the offset
	  ts.on('change', function (offset) {
	  	OFFSET = offset;
	  	console.log("OFFSET: ", OFFSET);
	  });
	 
	  function submitConnection(event) {
	    document.getElementById("waiting").style.color = "black";
	    document.getElementById("fs").style.color = "white";
	    document.getElementById("ff").style.color = "white";
	    socket.emit('join', "Add me please");
	  }

	  var countdown;

	  socket.on("getReady", function(data) {
			countdown = Math.trunc((data.time - ts.now() ) / 1000 );
	  	let hashInterval = setInterval(function(){ console.log(countdown); countdown--; }, 1000);
	  	setTimeout(function (hashInterval) {clearInterval()}, 60000);
	  	setTimeout(function () {
	  		document.getElementById("boom").style.color = "red";
	  		document.getElementById("waiting").style.color = "white";
	  	}, data.time - ts.now())
	  });

      socket.on("DOWNLOAD NOW", function(data){
      	  // data.nextSong
      })

	</script> 
</head>
<body>

    <div id="nextSong">
    </div>
	<audio controls>
		<source="/testAudio" >
	</audio>

	<h1 id="boom" style="color:white">BOOM</h1>
	<h2 id="waiting" style="color:white">Waiting....</h2>
	<form action="JavaScript:submitConnection()">
	  <p id="ff" >Connect to waiting list</p>
	  <input id="fs" type='submit' value="Submit">
	</form>
</body>
</html>
